<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="Status Update">
    <Require feature="wave"/>
    <Require feature="dynamic-height" />   
  </ModulePrefs>
  <Content type="html">
    <![CDATA[
      <div> 
        <script type="text/javascript" src="http://jqueryjs.googlecode.com/files/jquery-1.3.2.min.js"></script>
      
        <h1>What is your status?</h1>
        <p>
          <input type=text value="" id="txtStatus">
        </p>
        <p>
          <input type=button value="Update Status" id='butUpdateStatus' onClick="recordStatus();">
        </p>
        <div id='status_summary'> </div>
        <div id='my_debug'> </div>
        <hr />

        <script type="text/javascript">
          var summary = $('#status_summary');
          var status = $('#txtStatus');
          var debug = $('#my_debug');
 
          function recordStatus() {
            viewerId = wave.getViewer().getId().toString();
            state = wave.getState();
            
            delta = {};
            delta[viewerId] = status.val();
            
            state.submitDelta(delta);
          }

          function stateUpdated() {
            state = wave.getState();
            keys = state.getKeys();

            summary.html('');
            for(i = 0; i < keys.length; i++) {
              summary.html("<p>" + keys[i] + " is " + state.get(keys[i]) + "</p>" + summary.html());
            }
          }

          function init() {
            if (wave && wave.isInWaveContainer()) {
              wave.setStateCallback(stateUpdated);
            }
          
            debug.text(wave.getParticipants().length);
          }
        
          gadgets.util.registerOnLoadHandler(init);

        </script>
    
      </div>
    ]]>
  </Content>
</Module>
